<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script> -->
		<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0/handlebars.min.js"></script>
		<script src="assets/js/script.js"></script>

		<link rel="stylesheet" type="text/css" href="assets/css/stocks.css">
		<link href="http://fonts.googleapis.com/css?family=Open+Sans:400" rel="stylesheet">

		<script type="text/javascript" >
			// function reqListener () {
			// 	var stocks = this.responseText;
			// 	stocks = stocks.trim();
			// 	stocks = stocks.replace(/^\/|\/$/g, '');
			// 	stocks = stocks.replace(/^\/|\/$/g, '');
			// 	stocks = stocks.trim();

			// 	var jsonStocks = JSON.parse(stocks);
			//   	console.log(jsonStocks);
			// }
			function getStock(exchangeIndex, symbol) {
				// var oReq = new XMLHttpRequest();
				// oReq.addEventListener("load", reqListener);

				// // var stockSymbol = $("#stockSymbol").val();
				
				// oReq.open("GET", "http://finance.google.com/finance/info?client=ig&q=" + exchangeIndex + "%3A" + symbol);
				// oReq.send();


				$.get( "http://finance.google.com/finance/info?client=ig&q=" + exchangeIndex + "%3A" + symbol, function(data) {
				
				})
				  .done(function(data) {
				   	var stocks = data;
					stocks = stocks.trim();
					stocks = stocks.replace(/^\/|\/$/g, '');
					stocks = stocks.replace(/^\/|\/$/g, '');
					stocks = stocks.trim();

					var jsonStocks = JSON.parse(stocks);
				  	console.log(jsonStocks);

				  	var listing = jsonStocks[0].l;
				  	var priceChange = parseFloat(jsonStocks[0].c);
				  	var priceChangeCSS = (priceChange > 0)?  'gain' : 'loss';

				  	priceChange = (priceChange > 0) ? '+ $' + priceChange : '- $' + jsonStocks[0].c.replace('-', '');


				  	// https://stackoverflow.com/questions/149055/how-can-i-format-numbers-as-money-in-javascript
				  	// The new ECMAScript Internationalization API offers a numberformat function.

				  	var formatter = new Intl.NumberFormat('en-US', {
									  style: 'currency',
									  currency: 'USD',
									  minimumFractionDigits: 2,
									});

				  	$("#featured-stock").empty();
				  	$("#featured-stock").append(
				  		"<h1 class='stockH1'>$" + jsonStocks[0].t + "</h1><sub>(" + jsonStocks[0].e + ")</sub><br />" +
				  		"<b class='featured-stock'>"  + formatter.format(listing) + "</b>" +
				  		"<br /><b class='" + priceChangeCSS + " featured-stock'>" + priceChange + "</b>"
				  	);

				  })
				  .fail(function() {
				    alert( "error" );
				  })
				  .always(function() {
				    console.log( "get request finished" );
				  });
			}

		</script>

	</head>
	<body>
		<header class="compact">
			<h1><a href="#">Stock Search</a></h1>
		</header>

		<div class="main-content">

		<div class="all-products page">

			<div class="filters">
				<form>

					<div class="filter-criteria">
						<span>Sector</span>
						<label><input type="checkbox" name="Sector" value="n/a">n/a</label>
						<label><input type="checkbox" name="Sector" value="BasicIndustries">Basic Industries</label>
						<label><input type="checkbox" name="Sector" value="CapitalGoods">Capital Goods</label>
						<label><input type="checkbox" name="Sector" value="ConsumerDurables">Consumer Durables</label>
						<label><input type="checkbox" name="Sector" value="ConsumerNon-Durables">Consumer Non-Durables</label>
						<label><input type="checkbox" name="Sector" value="ConsumerServices">Consumer Services</label>
						<label><input type="checkbox" name="Sector" value="Energy">Energy</label>
						<label><input type="checkbox" name="Sector" value="Finance">Finance</label>
						<label><input type="checkbox" name="Sector" value="HealthCare">Health Care</label>
						<label><input type="checkbox" name="Sector" value="Miscellaneous">Miscellaneous</label>
						<label><input type="checkbox" name="Sector" value="PublicUtilities">Public Utilities</label>
						<label><input type="checkbox" name="Sector" value="Transportation">Transportation</label>
						<label><input type="checkbox" name="Sector" value="Technology">Technology</label>
					</div>


					<button>Clear filters</button>

				</form>

			</div>

			<ul class="products-list">
				<script id="products-template" type="x-handlebars-template">​
					{{#each this}}
						<li data-index="{{id}}">
							<a href="#" class="product-photo">{{Symbol}}</a>
							<h2><a href="#"> {{name}} </a></h2>
							<ul class="product-description">
								<li><span>Name: </span>{{Name}}</li>
								<li><span>Symbol: </span>{{Symbol}}</li>
								<li><span>Sector: </span>{{Sector}}</li>
							</ul>
							<button>Buy Now!</button>
							<p class="product-price">{{MarketCap}}</p>
							<div class="highlight"></div>
						</li>
					{{/each}}
				</script> 
			</ul>

		</div>


		<div class="single-product page">

			<div class="overlay"></div>

			<div class="preview-large">
				<h3>Single product view</h3>
				
				<p></p>

				<span class="close">×</span>
			</div>

		</div>

		<div class="error page">
			<h3>Sorry, something went wrong :(</h3>
		</div>

	</div> <!-- End of 'main-content' -->


		<!-- below is your old code, above is attempt to use handle bars to display all stocks... -->

		<table align="center">
			<thead>
				<tr>
					<th>NASDAQ</th>
					<th>NYSE</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>
						<select id="nasdaq-select">
							<option value="">NASDAQ listed Companies</option>
						</select>
					</td>
					<td>
						<select id="nyse-select">
							<option value="">NYSE listed Companies</option>
						</select>
					</td>
				</tr>
				<tr>
					<td>
						<input id="nasdaq-input" type="text" placeholder="Enter NASDAQ stock symbol" />
						<button id="nasdaq-submit" >get Stock</button>
					</td>
					<td>
						<input id="nyse-input" type="text" placeholder="Enter NYSE stock symbol" />
						<button id="nyse-submit" >get Stock</button>
					</td>
				</tr>
			</tbody>
		</table>
		
		<div id="featured-stock" ></div>







































	</body>

</html>